const ARCANA = [
  {
    id: "fool",
    Arcana: "The Fool",
    "UPRIGHT.START": "living a happy life and being carefree",
    "UPRIGHT.MID": "pay more attention to your surroundings",
    "UPRIGHT.END": "new things in your life",
    "REVERSED.START": "making yourself a fool",
    "REVERSED.MID": "act like a girl",
    "REVERSED.END": "more things to whine about",
  },
  {
    id: "magician",
    Arcana: "The Magician",
    "UPRIGHT.START": "finding new things",
    "UPRIGHT.MID": "be focused on one thing and don't stop doing what you are doing",
    "UPRIGHT.END": "everything you want, if you will do everything for it to happen",
    "REVERSED.START": "fooling people and lying",
    "REVERSED.MID": "be a pussy",
    "REVERSED.END": "rotting in hell",
  },
  {
    id: "hipriestess",
    Arcana: "The High Priestess",
    "UPRIGHT.START": "not paying attention to your intuiton and your dreams",
    "UPRIGHT.MID": "trust your intuition more",
    "UPRIGHT.END": "becoming the one with your true self",
    "REVERSED.START": "not trusting your imaginary friends",
    "REVERSED.MID": "not to trust yourself (like you always do)",
    "REVERSED.END": "your imaginary friends leaving you",
  },
  {
    id: "empress",
    Arcana: "The Empress",
    "UPRIGHT.START": "looking for beautiful things in your life",
    "UPRIGHT.MID": "treat yourself and people around you better",
    "UPRIGHT.END": "becoming a better person and making others smile",
    "REVERSED.START": "not loving your waifu enough",
    "REVERSED.MID": "pay too much attention to 3d girls",
    "REVERSED.END": "your waifu becoming shit",
  },
  {
    id: "emperor",
    Arcana: "The Emperor",
    "UPRIGHT.START": "facing difficult choices",
    "UPRIGHT.MID": "maitain your concentration and focus",
    "UPRIGHT.END": "becoming more succesful in life",
    "REVERSED.START": "being an emo kid",
    "REVERSED.MID": "not to act like a real man",
    "REVERSED.END": "you becoming a little girl",
  },
  {
    id: "hiero",
    Arcana: "The Hierophant",
    "UPRIGHT.START": "changing the world around you",
    "UPRIGHT.MID": "do what is expected of you",
    "UPRIGHT.END": "finding wisdom and knowledge",
    "REVERSED.START": "being a rebel",
    "REVERSED.MID": "be edgy",
    "REVERSED.END": "you being forever alone",
  },
  {
    id: "lovers",
    Arcana: "The Lovers",
    "UPRIGHT.START": "figuring out what you stand for and what the life is",
    "UPRIGHT.MID": "think about your decisions and choices you are facing",
    "UPRIGHT.END": "becoming honest with yourself",
    "REVERSED.START": "trying to love a 3d girl",
    "REVERSED.MID": "look at 3d girls",
    "REVERSED.END": "even your waifu leaving you",
  },
  {
    id: "chariot",
    Arcana: "The Chariot",
    "UPRIGHT.START": "trying to have more control over things in your life",
    "UPRIGHT.MID": "be determined, self-disciplined, and hard working",
    "UPRIGHT.END": "you will become more self-disciplined",
    "REVERSED.START": "losing your shit",
    "REVERSED.MID": "be a control freak",
    "REVERSED.END": "you dying alone",
  },
  {
    id: "strength",
    Arcana: "Strength",
    "UPRIGHT.START": "looking for inner strength to overcome any obstacle",
    "UPRIGHT.MID": "draw upon your inner strength",
    "UPRIGHT.END": "you will know how to tame the beast within yourself",
    "REVERSED.START": "starting to become a hikikomori",
    "REVERSED.MID": "play too much rpg games",
    "REVERSED.END": "drinking bleach",
  },
  {
    id: "hermit",
    Arcana: "The Hermit",
    "UPRIGHT.START": "trying to understand the things around you",
    "UPRIGHT.MID": "find your inner light",
    "UPRIGHT.END": "looking at your life with a deeper understanding",
    "REVERSED.START": "watching too much anime, like the weeb you are,",
    "REVERSED.MID": "want to be an anime character",
    "REVERSED.END": "people pointing fingers at you",
  },
  {
    id: "wheel",
    Arcana: "Wheel of Fortune",
    "UPRIGHT.START": "getting hard life and losing hope",
    "UPRIGHT.MID": "accept what life hands you",
    "UPRIGHT.END": "you will appreciate the good things that happen in your life",
    "REVERSED.START": "whining about bad things happening in your life",
    "REVERSED.MID": "blame people and your bad luck",
    "REVERSED.END": "using only the sad pepe meme",
  },
  {
    id: "justice",
    Arcana: "Justice",
    "UPRIGHT.START": "looking for justice in your life",
    "UPRIGHT.MID": "speak the truth",
    "UPRIGHT.END": "things becoming fair",
    "REVERSED.START": "trying to blame the others for your mistakes",
    "REVERSED.MID": "not taking responsibility for your actions (you little girl)",
    "REVERSED.END": "being a whiny girl for the rest of your life",
  },
  {
    id: "hanged",
    Arcana: "The Hanged Man",
    "UPRIGHT.START": "feeling stuck in your life",
    "UPRIGHT.MID": "become more open to different experiences",
    "UPRIGHT.END": "letting go all of your worries and concerns that you have",
    "REVERSED.START": "thinking that things are going slow, but you are the slowpoke",
    "REVERSED.MID": "be a lazy ass",
    "REVERSED.END": "laying on your bad and becoming a fat weeb",
  },
  {
    id: "death",
    Arcana: "Death",
    "UPRIGHT.START": "focusing on the past too much",
    "UPRIGHT.MID": "put the past behind you and focus on the present",
    "UPRIGHT.END": "letting the past go and focusing on the present",
    "REVERSED.START": "being stuck in limbo, Dante,",
    "REVERSED.MID": "not transforming, you pokemon,",
    "REVERSED.END": "staying in your little shell, you damn clam",
  },
  {
    id: "temper",
    Arcana: "Temperance",
    "UPRIGHT.START": "trying to moderate your life",
    "UPRIGHT.MID": "be patient to act with timing and precision",
    "UPRIGHT.END": "finding a purpose in your life",
    "REVERSED.START": "keeping your guns up, Stalin,",
    "REVERSED.MID": "make a mess out of everything,loser,",
    "REVERSED.END": "making your mom cleaning up everything after you",
  },
  {
    id: "devil",
    Arcana: "The Devil",
    "UPRIGHT.START": "fearing the future",
    "UPRIGHT.MID": "ask yourself where are you feeling stuck",
    "UPRIGHT.END": "recalling the things you forgot",
    "REVERSED.START": "fighting everyone, you jerk,",
    "REVERSED.MID": "not caring about people",
    "REVERSED.END": "everyone hating you",
  },
  {
    id: "tower",
    Arcana: "The Tower",
    "UPRIGHT.START": "with something blowing your mind",
    "UPRIGHT.MID": "break the shell around you",
    "UPRIGHT.END": "find new things in your life",
    "REVERSED.START": "thinking too much of yourself",
    "REVERSED.MID": "consider yourself cooler than others",
    "REVERSED.END": "deal with people laughing at you",
  },
  {
    id: "star",
    Arcana: "The Star",
    "UPRIGHT.START": "looking for hope",
    "UPRIGHT.MID": "being open to new ideas",
    "UPRIGHT.END": "having faith in yourself",
    "REVERSED.START": "feeling that everything is boring for you",
    "REVERSED.MID": "not believing that anime is real",
    "REVERSED.END": "you forever living with your mom",
  },
  {
    id: "moon",
    Arcana: "The Moon",
    "UPRIGHT.START": "being focused on your past",
    "UPRIGHT.MID": "finding the inner yourself",
    "UPRIGHT.END": "not fearing the inner yourself",
    "REVERSED.START": "watching too much illusionist shows",
    "REVERSED.MID": "try becoming an illusionist",
    "REVERSED.END": "being a failure",
  },
  {
    id: "sun",
    Arcana: "The Sun",
    "UPRIGHT.START": "shining like a sun",
    "UPRIGHT.MID": "living a simple life",
    "UPRIGHT.END": "seing the path ahead of you",
    "REVERSED.START": "thinking you are too cool",
    "REVERSED.MID": "you trying to achieve something",
    "REVERSED.END": "the only achievement you got being: \"Sad for Life\"",
  },
  {
    id: "judge",
    Arcana: "Judgement",
    "UPRIGHT.START": "trying to live your life in a different way",
    "UPRIGHT.MID": "changing things in your life",
    "UPRIGHT.END": "facing life as it is",
    "REVERSED.START": "not liking to make decisions",
    "REVERSED.MID": "be a smartass",
    "REVERSED.END": "you talking to yourself",
  },
  {
    id: "zawarudo",
    Arcana: "The World",
    "UPRIGHT.START": "accomplishing everything you wanted",
    "UPRIGHT.MID": "finding a deeper understanding of your role",
    "UPRIGHT.END": "people pressing F to pay respects for you",
    "REVERSED.START": "not being too focused",
    "REVERSED.MID": "watch too much hentai",
    "REVERSED.END": "you being in prison",
  },
];

const Picto = require("../utilities/Picto");

class Tarot {
  constructor(msg = {}, spreadSize = 3) {
    this._deck = Tarot._shuffle(ARCANA);
    this.L = msg.lang || ["en"];
    this.spread = this.getSpread(spreadSize > 9 ? 9 : spreadSize);
  }

  getSpread(size) {
    let i = size;
    const spread = [];
    while (i--) {
      this._deck = Tarot._shuffle(this._deck);
      spread.push({ card: this._deck.pop(), pose: Tarot._pos() });
    }
    return spread;
  }

  async drawCard(arcana, posit, deck = "persona3") {
    const card = Picto.new(200, 350);
    const ctx = card.getContext("2d");
    const cardPic = await Picto.getCanvas(`${paths.CDN}/build/cards/tarot/${deck}/${arcana.id}.png`);
    const posname  = Picto.tag(ctx, posit, "400 20px Panton", "#A5A5A3");
    Picto.setAndDraw(ctx, posname, 100, 20, 180, "center");
    const arcaname = Picto.tag(ctx, arcana.Arcana, "900 24px Panton");
    Picto.setAndDraw(ctx, arcaname, 100, 310, 180, "center");

    if (posit === "REVERSED") {
      ctx.translate(0, 350);
      ctx.scale(-1, -1);
    }
    ctx.drawImage(cardPic, 25, 50, 150, 250);
    return card;
  }

  async drawSpread(skin) {
    const spSize = this.spread.length;
    const canvas = Picto.new(200 * spSize, 350);
    const ctx = canvas.getContext("2d");

    const SPREAD = this.spread;
    while (SPREAD.length) {
      const currSpd = SPREAD.pop();
      const L = SPREAD.length;
      tasks.push( this.drawCard(currSpd.card, currSpd.pose, skin).then((c) => ctx.drawImage(c, (spSize - (L) - 1) * 200, 0)));                 
    }
    await Promise.all(tasks);
    return canvas;
  }

  static _shuffle(array) {
    const newArray = array.slice();
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      const temp = newArray[i];
      newArray[i] = newArray[j];
      newArray[j] = temp;
    }
    return newArray;
  }

  static _pos() {
    const r = Math.floor(Math.random() * 10 + 1);
    return r % 2 === 0 ? "UPRIGHT" : "REVERSED";
  }
}

module.exports = Tarot;
